image: ruby:2.3

variables:
    JEKYLL_ENV: production
    GIT_SUBMODULE_STRATEGY: recursive

before_script:
    - bundle install
    - git submodule sync --recursive
    - git submodule update --init --recursive

test:
    stage: test
    script:
    - bundle exec jekyll build -d test
    artifacts:
        paths:
        - test
    except:
    - master

pages:
    stage: deploy
    script:
    - bundle exec jekyll build -d public
    artifacts:
        paths:
        - public
    only:
    - master
